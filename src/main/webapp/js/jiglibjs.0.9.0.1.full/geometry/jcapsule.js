(function(c){var f=c.Vector3DUtil;var b=c.JMatrix3D;var d=c.JNumber3D;var g=c.RigidBody;var h=c.JSegment;var e=function(k,j,i){this.Super(k);this._type="CAPSULE";this._radius=j;this._length=i;this._boundingSphere=this.getBoundingSphere(j,i);this.set_mass(1);this.updateBoundingBox();};c.extend(e,c.RigidBody);e.prototype._length=null;e.prototype._radius=null;e.prototype.set_radius=function(i){this._radius=i;this._boundingSphere=getBoundingSphere(this._radius,this._length);this.setInertia(this.getInertiaProperties(this.get_mass()));this.updateBoundingBox();this.setActive();};e.prototype.get_radius=function(){return this._radius;};e.prototype.set_length=function(i){this._length=i;this._boundingSphere=getBoundingSphere(this._radius,this._length);this.setInertia(this.getInertiaProperties(this.get_mass()));this.updateBoundingBox();this.setActive();};e.prototype.get_length=function(){return this._length;};e.prototype.getBottomPos=function(j){var i=j.getOrientationCols()[1];return f.add(j.position,d.getScaleVector(i,-this._length/2-this._radius));};e.prototype.getEndPos=function(j){var i=j.getOrientationCols()[1];return f.add(j.position,d.getScaleVector(i,this._length/2+this._radius));};e.prototype.segmentIntersect=function(y,A,n){y.fracOut=0;y.posOut=[0,0,0,0];y.normalOut=[0,0,0,0];var j=A.delta;var C=f.dotProduct(j,j);var x=this._radius*this._radius;var u=n.getOrientationCols();var p=new h(getBottomPos(n),u[1]);var r=p.delta;var o=f.subtract(p.origin,A.origin);var s=f.dotProduct(r,r);if(Math.abs(s)<d.NUM_TINY){return false;}var k=f.dotProduct(r,j);var z=f.dotProduct(o,j);var q=f.dotProduct(r,o);var i=f.dotProduct(o,o);var m=f.get_lengthSquared(f.subtract(o,d.getDivideVector(d.getScaleVector(r,q),s)));if(m<x){y.fracOut=0;y.posOut=A.origin.slice(0);y.normalOut=f.subtract(y.posOut,getBottomPos(n));y.normalOut=f.subtract(y.normalOut,d.getScaleVector(u[1],f.dotProduct(y.normalOut,u[1])));f.normalize(y.normalOut);return true;}var w=s*C-(k*k);if(Math.abs(a)<d.NUM_TINY){return false;}var D=2*(q*k-s*z);var B=s*(i-x)-(q*q);var l=(D*D)-4*a*B;if(l<0){return false;}var v=(-D-Math.sqrt(l))/(2*a);if(v<0||v>1){return false;}y.fracOut=v;y.posOut=A.getPoint(v);y.normalOut=f.subtract(y.posOut,getBottomPos(n));y.normalOut=f.subtract(y.normalOut,d.getScaleVector(u[1],f.dotProduct(y.normalOut,u[1])));f.normalize(y.normalOut);return true;};e.prototype.getInertiaProperties=function(i){var l=i*Math.PI*this._radius*this._radius*this._length/this.getVolume();var j=0.25*l*this._radius*this._radius+(1/12)*l*this._length*this._length;var k=0.5*l*this._radius*this._radius;var n=j;var o=i-l;j+=(0.4*o*this._radius*this._radius+o*Math.pow(0.5*this._length,2));k+=(0.2*o*this._radius*this._radius);n+=(0.4*o*this._radius*this._radius+o*Math.pow(0.5*this._length,2));return b.getScaleMatrix(j,k,n);};e.prototype.updateBoundingBox=function(){this._boundingBox.clear();this._boundingBox.addCapsule(this);};e.prototype.getBoundingSphere=function(j,i){return Math.sqrt(Math.pow(i/2,2)+j*j)+j;};e.prototype.getVolume=function(){return(4/3)*Math.PI*this._radius*this._radius*this._radius+this._length*Math.PI*this._radius*this._radius;};c.JCapsule=e;})(jigLib);