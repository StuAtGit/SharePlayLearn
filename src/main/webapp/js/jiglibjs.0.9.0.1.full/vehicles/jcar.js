(function(e){var j=e.Vector3DUtil;var a=e.JNumber3D;var b=e.JChassis;var d=e.JWheel;var f=e.PhysicsSystem;var c=Math,i=c.abs,h=c.sqrt;var g=function(k){this._chassis=new b(this,k);this._wheels=[];this._steerWheels=[];this._destSteering=this._destAccelerate=this._steering=this._accelerate=this._HBrake=0;this.setCar();};g.prototype._maxSteerAngle=null;g.prototype._steerRate=null;g.prototype._driveTorque=null;g.prototype._destSteering=null;g.prototype._destAccelerate=null;g.prototype._steering=null;g.prototype._accelerate=null;g.prototype._HBrake=null;g.prototype._chassis=null;g.prototype._wheels=null;g.prototype._steerWheels=null;g.prototype.setCar=function(m,l,k){if(m==null){m=45;}if(l==null){l=4;}if(k==null){k=500;}this._maxSteerAngle=m;this._steerRate=l;this._driveTorque=k;};g.prototype.setupWheel=function(y,o,t,w,m,D,C,p,s,z){if(t==null){t=2;}if(w==null){w=2;}if(m==null){m=3;}if(D==null){D=10;}if(C==null){C=0.5;}if(p==null){p=0.5;}if(s==null){s=1;}if(z==null){z=1;}var n=f.getInstance().get_gravity().slice(0);var v=this._chassis.get_mass();var q=0.25*v;var A=j.get_length(n);j.normalize(n);var k=a.getScaleVector(n,-1);var u=q*A/(C*m);var r=0.015*D*D*v;var l=p/2;var x=A*q;var B=new d(this);B.name=y;B.setup(o,k,u,m,r,D,t,w,l,s,z,x);this._wheels.push(B);};g.prototype.setAccelerate=function(k){this._destAccelerate=k;};g.prototype.setSteer=function(p,o){this._destSteering=o;this._steerWheels=[];var m=null;for(var n=0,k=p.length;n<k;n++){m=this.getWheel(p[n]);if(m){this._steerWheels.push(m);}}};g.prototype.findWheel=function(m){for(var n=0,k=this._wheels.length;n<k;n++){if(this._wheels[n].name==m){return true;}}return false;};g.prototype.getWheel=function(k){for(var l=0;l<this._wheels.length;l++){if(this._wheels[l].name==k){return this._wheels[l];}}return null;};g.prototype.setHBrake=function(k){this._HBrake=k;};g.prototype.addExternalForces=function(l){for(var k=0,m=this._wheels.length;k<m;k++){this._wheels[k].addForcesToCar(l);}};g.prototype.postPhysics=function(l){for(var o=0,t=this._wheels.length;o<t;o++){this._wheels[o].update(l);}var k=l;var q=l*this._steerRate;var m=this._destAccelerate-this._accelerate;if(m<-k){m=-k;}else{if(m>k){m=k;}}this._accelerate+=m;var r=this._destSteering-this._steering;if(r<-q){r=-q;}else{if(r>q){r=q;}}this._steering+=r;for(var o=0;o<this._wheels.length;o++){this._wheels[o].addTorque(this._driveTorque*this._accelerate);this._wheels[o].setLock(this._HBrake>0.5);}var n=i(this._maxSteerAngle*this._steering);var p=(this._steering>0)?1:-1;for(var o=0,s=this._steerWheels.length;o<s;o++){this._steerWheels[o].setSteerAngle(p*n);}};g.prototype.getNumWheelsOnFloor=function(m){var l=0;for(var k=0,n=this._wheels.length;k<n;k++){if(this._wheels[k].getOnFloor()){l++;}}return l;};e.JCar=g;})(jigLib);