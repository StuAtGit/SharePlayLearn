(function(c){var e=c.Vector3DUtil;var b=c.JMatrix3D;var d=c.JNumber3D;var a=function(i,k,g,h,j,f){this.Super();this._body0=i;this._body0Pos=k;this._body1=g;this._body1Pos=h;this._allowedDistance=(j)?j:1;this._timescale=(f)?f:1;if(this._timescale<d.NUM_TINY){_timescale=d.NUM_TINY;}i.addConstraint(this);g.addConstraint(this);};c.extend(a,c.JConstraint);a.prototype._maxVelMag=20;a.prototype._minVelForProcessing=0.01;a.prototype._body0=null;a.prototype._body1=null;a.prototype._body0Pos=null;a.prototype._body1Pos=null;a.prototype._timescale=null;a.prototype._allowedDistance=null;a.prototype.r0=null;a.prototype.r1=null;a.prototype._worldPos=null;a.prototype._vrExtra=null;a.prototype.preApply=function(j){this.set_satisfied(false);this.r0=this._body0Pos.slice(0);b.multiplyVector(this._body0.get_currentState().get_orientation(),this.r0);this.r1=this._body1Pos.slice(0);b.multiplyVector(this._body1.get_currentState().get_orientation(),this.r1);var g=e.add(this._body0.get_currentState().position,this.r0);var f=e.add(this._body1.get_currentState().position,this.r1);this._worldPos=d.getScaleVector(e.add(g,f),0.5);var i=e.subtract(g,f);var h=e.get_length(i);if(h>this._allowedDistance){this._vrExtra=d.getScaleVector(i,(h-this._allowedDistance)/(h*Math.max(this._timescale,j)));}else{this._vrExtra=[0,0,0,0];}};a.prototype.apply=function(h){this.set_satisfied(true);if(!this._body0.isActive&&!this._body1.isActive){return false;}var m=this._body0.getVelocity(this.r0);var l=this._body1.getVelocity(this.r1);var f=e.add(this._vrExtra,e.subtract(m,l));var k=e.get_length(f);if(k<this._minVelForProcessing){return false;}if(k>this._maxVelMag){f=d.getScaleVector(f,this._maxVelMag/k);k=this._maxVelMag;}var n=d.getDivideVector(f,k);var p=e.crossProduct(this.r0,n);b.multiplyVector(this._body0.get_worldInvInertia(),p);var o=e.crossProduct(this.r1,n);b.multiplyVector(this._body1.get_worldInvInertia(),o);var j=this._body0.get_invMass()+this._body1.get_invMass()+e.dotProduct(n,e.crossProduct(p,this.r0))+e.dotProduct(n,e.crossProduct(o,this.r1));if(j<d.NUM_TINY){return false;}var i=d.getScaleVector(n,-k/j);var g=d.getScaleVector(i,-1);this._body0.applyWorldImpulse(i,this._worldPos);this._body1.applyWorldImpulse(g,this._worldPos);this._body0.setConstraintsAndCollisionsUnsatisfied();this._body1.setConstraintsAndCollisionsUnsatisfied();this.set_satisfied(true);return true;};c.JConstraintPoint=a;})(jigLib);