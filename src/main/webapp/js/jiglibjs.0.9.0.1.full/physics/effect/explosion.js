(function(a){var b=a.Vector3DUtil;var c=function(e,f,d,h,g){this.Super();this.location=e;this.radius=f;this.force=d;if(h){this.parent=h;}if(h&&g){this.relativity=true;}this.enabled=false;};a.extend(c,a.JEffect);c.prototype.location=null;c.prototype.radius=null;c.prototype.force=null;c.prototype.parent=null;c.prototype.relativity=false;c.prototype.explode=function(){this.enabled=true;};c.prototype.Apply=function(){this.enabled=false;var g=a.PhysicsSystem.getInstance();var e=g.get_bodies();var f=e.length;var l,k,h,j;var d=[0,0,0,0];if(this.parent){this.location=this.parent.get_position();}this._affectedBodies=[];while(f--){l=e[f];if(this.parent&&l==this.parent){continue;}if(l._type!="PLANE"){k=b.distance(l.get_position(),this.location);if(k<this.radius){j=b.subtract(l.get_position(),this.location);h=(1-(k/this.radius))*this.force;b.scaleBy(j,h);if(this.relativity){d=b.add(j,d);}if(l.get_movable()){g.activateObject(l);l.addWorldForce(j,this.location);}}}else{if(this.relativity){k=l.pointPlaneDistance(this.location);if(k<this.radius){j=b.negate(l.get_normal().slice(0));h=(1-(k/this.radius))*(this.force*2);b.scaleBy(j,h);d=b.add(j,d);}}}}if(this.relativity){b.limitSum(d,this.force);b.negate(d);g.activateObject(this.parent);this.parent.applyWorldImpulse(d,this.location);}};a.Explosion=c;})(jigLib);