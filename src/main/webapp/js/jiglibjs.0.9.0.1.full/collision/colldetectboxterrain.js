(function(e){var i=e.Vector3DUtil;var a=e.JNumber3D;var h=e.JConstraint;var g=e.JConfig;var f=e.JTerrain;var d=e.JBox;var c=e.MaterialProperties;var j=e.RigidBody;var b=function(){this.name="BoxTerrain";this.type0="BOX";this.type1="TERRAIN";};e.extend(b,e.CollDetectFunctor);b.prototype.collDetect=function(o,y){var t;if(o.body0.type=="TERRAIN"){t=o.body0;o.body0=o.body1;o.body1=t;}var s=o.body0;var m=o.body1;var v=s.getCornerPoints(s.oldState);var A=s.getCornerPoints(s.currentState);var u=[0,0,0,0];var r;var x;var l;var k;var p=[];var n;for(var q=0;q<8;q++){l=A[q];r=m.getHeightAndNormalByPoint(l);if(r.height<g.collToll){k=v[q];x=m.getHeightByPoint(k);u=i.add(u,r.normal);n=new CollPointInfo();n.r0=i.subtract(k,s.oldState.position);n.r1=i.subtract(k,m.oldState.position);n.initialPenetration=-x;p.push(n);}}if(p.length>0){i.normalize(u);var w=new CollisionInfo();w.objInfo=o;w.dirToBody=u;w.pointInfo=p;var z=new c();z.restitution=Math.sqrt(s.material.restitution*m.material.restitution);z.friction=Math.sqrt(s.material.friction*m.material.friction);w.mat=z;y.push(w);o.body0.collisions.push(w);o.body1.collisions.push(w);}};e.CollDetectBoxTerrain=b;})(jigLib);