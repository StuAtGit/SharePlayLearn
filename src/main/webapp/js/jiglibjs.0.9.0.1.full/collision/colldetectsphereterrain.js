(function(c){var i=c.Vector3DUtil;var a=c.JNumber3D;var g=c.JConstraint;var e=c.JConfig;var f=c.JSphere;var d=c.JTerrain;var b=c.MaterialProperties;var j=c.RigidBody;var h=function(){this.name="SphereTerrain";this.type0="SPHERE";this.type1="TERRAIN";};c.extend(h,c.CollDetectFunctor);h.prototype.collDetect=function(n,v){var s;if(n.body0.type=="TERRAIN"){s=n.body0;n.body0=n.body1;n.body1=s;}var p=n.body0;var k=n.body1;var r=k.getHeightAndNormalByPoint(p.currentState.position);if(r.height<e.collToll+p.radius){var u=k.getHeightByPoint(p.oldState.position);var q=p.radius-u;var l=i.subtract(p.oldState.position,a.getScaleVector(r.normal,p.radius));var o=[];var m=new CollPointInfo();m.r0=i.subtract(l,p.oldState.position);m.r1=i.subtract(l,k.oldState.position);m.initialPenetration=q;o.push(m);var t=new CollisionInfo();t.objInfo=n;t.dirToBody=r.normal;t.pointInfo=o;var w=new b();w.restitution=Math.sqrt(p.material.restitution*k.material.restitution);w.friction=Math.sqrt(p.material.friction*k.material.friction);t.mat=w;v.push(t);n.body0.collisions.push(t);n.body1.collisions.push(t);}};c.CollDetectSphereTerrain=h;})(jigLib);