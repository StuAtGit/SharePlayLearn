(function(c){var j=c.Vector3DUtil;var a=c.JNumber3D;var g=c.JConstraint;var e=c.JConfig;var h=c.JCapsule;var d=c.JPlane;var b=c.MaterialProperties;var l=c.RigidBody;var i=c.CollPointInfo;var k=c.CollisionInfo;var f=function(){this.name="CapsulePlane";this.type0="CAPSULE";this.type1="PLANE";};c.extend(f,c.CollDetectFunctor);f.prototype.collDetect=function(m,z){var u;if(m.body0.get_type()=="PLANE"){u=m.body0;m.body0=m.body1;m.body1=u;}var r=m.body0;var t=m.body1;var q=[];var n;var s=r.getBottomPos(r.get_oldState());var y=t.pointPlaneDistance(s);var x=r.getBottomPos(r.get_currentState());var p=t.pointPlaneDistance(x);if(Math.min(y,p)<r.get_radius()+e.collToll){var v=r.get_radius()-y;var o=j.subtract(s,a.getScaleVector(t.get_normal(),r.get_radius()));n=new i();n.r0=j.subtract(o,r.get_oldState().position);n.r1=j.subtract(o,t.get_oldState().position);n.initialPenetration=v;q.push(n);}s=r.getEndPos(r.get_oldState());x=r.getEndPos(r.get_currentState());y=t.pointPlaneDistance(s);p=t.pointPlaneDistance(x);if(Math.min(y,p)<r.get_radius()+e.collToll){v=r.get_radius()-y;o=j.subtract(s,a.getScaleVector(t.get_normal(),r.get_radius()));n=new i();n.r0=j.subtract(o,r.get_oldState().position);n.r1=j.subtract(o,t.get_oldState().position);n.initialPenetration=v;q.push(n);}if(q.length>0){var w=new k();w.objInfo=m;w.dirToBody=t.get_normal();w.pointInfo=q;var A=new b();A.set_restitution(Math.sqrt(r.get_material().get_restitution()*t.get_material().get_restitution()));A.set_friction(Math.sqrt(r.get_material().get_friction()*t.get_material().get_friction()));w.mat=A;z.push(w);m.body0.collisions.push(w);m.body1.collisions.push(w);}};c.CollDetectCapsulePlane=f;})(jigLib);