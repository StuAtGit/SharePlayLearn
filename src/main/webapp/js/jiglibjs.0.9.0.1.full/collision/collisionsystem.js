(function(p){var l=p.JSegment;var i=p.RigidBody;var g=p.Vector3DUtil;var f=p.JNumber3D;var s=p.JConstraint;var t=p.CollDetectBoxBox;var o=p.CollDetectBoxPlane;var h=p.CollDetectBoxTerrain;var c=p.CollDetectCapsuleBox;var k=p.CollDetectCapsuleCapsule;var e=p.CollDetectCapsulePlane;var d=p.CollDetectCapsuleTerrain;var r=p.CollDetectSphereBox;var b=p.CollDetectSphereCapsule;var n=p.CollDetectSpherePlane;var m=p.CollDetectSphereSphere;var q=p.CollDetectSphereTerrain;var a=p.CollDetectInfo;var j=function(){this.collBody=[];detectionFunctors=[];detectionFunctors["BOX"]=[];detectionFunctors["BOX"]["BOX"]=new t();detectionFunctors["BOX"]["SPHERE"]=new r();detectionFunctors["BOX"]["CAPSULE"]=new c();detectionFunctors["BOX"]["PLANE"]=new o();detectionFunctors["BOX"]["TERRAIN"]=new h();detectionFunctors["SPHERE"]=[];detectionFunctors["SPHERE"]["BOX"]=new r();detectionFunctors["SPHERE"]["SPHERE"]=new m();detectionFunctors["SPHERE"]["CAPSULE"]=new b();detectionFunctors["SPHERE"]["PLANE"]=new n();detectionFunctors["SPHERE"]["TERRAIN"]=new q();detectionFunctors["CAPSULE"]=[];detectionFunctors["CAPSULE"]["CAPSULE"]=new k();detectionFunctors["CAPSULE"]["BOX"]=new c();detectionFunctors["CAPSULE"]["SPHERE"]=new b();detectionFunctors["CAPSULE"]["PLANE"]=new e();detectionFunctors["CAPSULE"]["TERRAIN"]=new d();detectionFunctors["PLANE"]=[];detectionFunctors["PLANE"]["BOX"]=new o();detectionFunctors["PLANE"]["SPHERE"]=new n();detectionFunctors["PLANE"]["CAPSULE"]=new e();detectionFunctors["TERRAIN"]=[];detectionFunctors["TERRAIN"]["SPHERE"]=new q();detectionFunctors["TERRAIN"]["BOX"]=new h();detectionFunctors["TERRAIN"]["CAPSULE"]=new d();this.detectionFunctors=detectionFunctors;};j.prototype.detectionFunctors=null;j.prototype.collBody=null;j.prototype.addCollisionBody=function(u){if(!this.findBody(u)){this.collBody.push(u);}};j.prototype.removeCollisionBody=function(u){if(this.findBody(u)){this.collBody.splice(this.collBody.indexOf(u),1);}};j.prototype.removeAllCollisionBodies=function(){this.collBody=[];};j.prototype.detectCollisions=function(u,x){if(!u.isActive){return;}var y;var z;for(var w=0,A=this.collBody.length;w<A;w++){var v=this.collBody[w];if(u!=v&&this.checkCollidables(u,v)&&this.detectionFunctors[u.get_type()][v.get_type()]!=undefined){y=new a();y.body0=u;y.body1=v;z=detectionFunctors[y.body0.get_type()][y.body1.get_type()];z.collDetect(y,x);}}};j.prototype.detectAllCollisions=function(u,D){var x;var B;var z;var E;for(var C=0,w=u.length;C<w;C++){var y=u[C];z=y.id;E=y.get_type();for(var A=0;A<this.collBody.length;A++){var v=this.collBody[A];if(y==v){continue;}if(v.isActive&&z>v.id){continue;}if(this.checkCollidables(y,v)&&this.detectionFunctors[E][v.get_type()]!=undefined){x=new a();x.body0=y;x.body1=v;B=detectionFunctors[x.body0.get_type()][x.body1.get_type()];B.collDetect(x,D);}}}};j.prototype.segmentIntersect=function(x,u,w){x.fracOut=f.NUM_HUGE;x.posOut=[0,0,0,0];x.normalOut=[0,0,0,0];var z={};for(var y=0,A=this.collBody.length;y<A;y++){var v=this.collBody[y];if(v!=w&&this.segmentBounding(u,v)){if(v.segmentIntersect(z,u,v.get_currentState())){if(z.fracOut<x.fracOut){x.posOut=z.posOut;x.normalOut=z.normalOut;x.fracOut=z.fracOut;x.bodyOut=v;}}}}if(x.fracOut>1){return false;}if(x.fracOut<0){x.fracOut=0;}else{if(x.fracOut>1){x.fracOut=1;}}return true;};j.prototype.segmentBounding=function(u,y){var z=u.getPoint(0.5);var v=g.get_length(u.delta)/2;if(y.get_type()!="PLANE"&&y.get_type()!="TERRAIN"){var x=g.get_length(g.subtract(z,y.get_currentState().position));var w=v+y.get_boundingSphere();if(x<=w){return true;}else{return false;}}else{return true;}};j.prototype.findBody=function(u){for(var w=0,x=this.collBody.length;w<x;w++){var v=this.collBody[w];if(u==v){return true;}}return false;};j.prototype.checkCollidables=function(y,w){if(y.get_nonCollidables().length==0&&w.get_nonCollidables().length==0){return true;}var v=y.get_nonCollidables();for(var x=0,u=v.length;x<u;x++){var A=v[x];if(w==A){return false;}}v=w.get_nonCollidables();for(var x=0,u=v.length;x<u;x++){var z=v[x];if(y==z){return false;}}return true;};p.CollisionSystem=j;})(jigLib);