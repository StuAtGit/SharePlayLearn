(function(c){var h=c.Vector3DUtil;var a=c.JNumber3D;var f=c.JConstraint;var e=c.JConfig;var g=c.JCapsule;var d=c.JTerrain;var b=c.MaterialProperties;var j=c.RigidBody;var i=function(){this.name="BoxTerrain";this.type0="CAPSULE";this.type1="TERRAIN";};c.extend(i,c.CollDetectFunctor);i.prototype.collDetect=function(l,w){var s;if(l.body0.type=="TERRAIN"){s=l.body0;l.body0=l.body1;l.body1=s;}var p=l.body0;var k=l.body1;var o=[];var m;var y=[0,0,0,0];var x=p.getBottomPos(p.oldState);var v=p.getBottomPos(p.currentState);var r=k.getHeightAndNormalByPoint(x);var q=k.getHeightAndNormalByPoint(v);if(Math.min(r.height,q.height)<e.collToll+p.radius){var t=p.radius-r.height;var n=h.subtract(x,a.getScaleVector(q.normal,p.radius));m=new CollPointInfo();m.r0=h.subtract(n,p.oldState.position);m.r1=h.subtract(n,k.oldState.position);m.initialPenetration=t;o.push(m);y=h.add(y,q.normal);}x=p.getEndPos(p.oldState);v=p.getEndPos(p.currentState);r=k.getHeightAndNormalByPoint(x);q=k.getHeightAndNormalByPoint(v);if(Math.min(r.height,q.height)<e.collToll+p.radius){t=p.radius-r.height;n=h.subtract(x,a.getScaleVector(q.normal,p.radius));m=new CollPointInfo();m.r0=h.subtract(n,p.oldState.position);m.r1=h.subtract(n,k.oldState.position);m.initialPenetration=t;o.push(m);y=h.add(y,q.normal);}if(o.length>0){h.normalize(y);var u=new CollisionInfo();u.objInfo=l;u.dirToBody=y;u.pointInfo=o;var z=new b();z.restitution=Math.sqrt(p.material.restitution*k.material.restitution);z.friction=Math.sqrt(p.material.friction*k.material.friction);u.mat=z;w.push(u);l.body0.collisions.push(u);l.body1.collisions.push(u);}};c.CollDetectCapsuleTerrain=i;})(jigLib);