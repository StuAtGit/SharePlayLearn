(function(b){var f=b.Vector3DUtil;var e=b.JNumber3D;var a=b.JConfig;var h=b.MaterialProperties;var c=b.CollPointInfo;var d=b.CollisionInfo;var g=function(){this.name="SphereBox";this.type0="SPHERE";this.type1="BOX";};b.extend(g,b.CollDetectFunctor);g.prototype.collDetect=function(j,u){var q;if(j.body0.get_type()=="BOX"){q=j.body0;j.body0=j.body1;j.body1=q;}var n=j.body0;var o=j.body1;if(!n.hitTestObject3D(o)){return;}if(a.aabbDetection&&!n.get_boundingBox().overlapTest(o.get_boundingBox())){return;}var p={};var x={};var v=o.getDistanceToPoint(o.get_oldState(),p,n.get_oldState().position);var m=o.getDistanceToPoint(o.get_currentState(),x,n.get_currentState().position);var r=n.get_radius()-v;var t=n.get_radius()-m;if(Math.max(r,t)>-a.collToll){var l;var k=[];if(v<-e.NUM_TINY){l=f.subtract(f.subtract(p.pos,n.get_oldState().position),p.pos);f.normalize(l);}else{if(v>e.NUM_TINY){l=f.subtract(n.get_oldState().position,p.pos);f.normalize(l);}else{l=f.subtract(n.get_oldState().position,o.get_oldState().position);f.normalize(l);}}var i=new c();i.r0=f.subtract(p.pos,n.get_oldState().position);i.r1=f.subtract(p.pos,o.get_oldState().position);i.initialPenetration=r;k.push(i);var s=new d();s.objInfo=j;s.dirToBody=l;s.pointInfo=k;var w=new h();w.set_restitution(Math.sqrt(n.get_material().get_restitution()*o.get_material().get_restitution()));w.set_friction(Math.sqrt(n.get_material().get_friction()*o.get_material().get_friction()));s.mat=w;u.push(s);j.body0.collisions.push(s);j.body1.collisions.push(s);}};b.CollDetectSphereBox=g;})(jigLib);