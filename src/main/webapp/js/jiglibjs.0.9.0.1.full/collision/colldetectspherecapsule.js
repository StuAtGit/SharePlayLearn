(function(c){var i=c.Vector3DUtil;var d=c.JMatrix3D;var a=c.JNumber3D;var g=c.JConstraint;var e=c.JConfig;var f=c.JSphere;var k=c.JSegment;var b=c.MaterialProperties;var m=c.RigidBody;var h=c.CollPointInfo;var j=c.CollisionInfo;var l=function(){this.name="SphereCapsule";this.type0="SPHERE";this.type1="CAPSULE";};c.extend(l,c.CollDetectFunctor);l.prototype.collDetect=function(D,B){var w;if(D.body0.get_type()=="CAPSULE"){w=D.body0;D.body0=D.body1;D.body1=w;}var p=D.body0;var v=D.body1;if(!p.hitTestObject3D(v)){return;}if(e.aabbDetection&&!p.get_boundingBox().overlapTest(v.get_boundingBox())){return;}var o=new k(v.getBottomPos(v.get_oldState()),a.getScaleVector(v.get_oldState().getOrientationCols()[1],i.get_length(v)+2*v.get_radius()));var x=new k(v.getBottomPos(v.get_currentState()),a.getScaleVector(v.get_currentState().getOrientationCols()[1],i.get_length(v)+2*v.get_radius()));var n=p.get_radius()+v.get_radius();var G={};var F=o.pointSegmentDistanceSq(G,p.get_oldState().position);var s={};var q=x.pointSegmentDistanceSq(s,p.get_currentState().position);if(Math.min(F,q)<Math.pow(n+e.collToll,2)){var u=o.getPoint(G.t);var E=i.subtract(p.get_oldState().position,u);var y=Math.sqrt(F);var H=n-y;if(y>a.NUM_TINY){E=a.getDivideVector(E,y);}else{E=i.Y_AXIS;d.multiplyVector(d.getRotationMatrix(0,0,1,360*Math.random()),E);}var t=i.add(u,a.getScaleVector(E,v.get_radius()-0.5*H));var A=[];var r=new h();r.r0=i.subtract(t,p.get_oldState().position);r.r1=i.subtract(t,v.get_oldState().position);r.initialPenetration=H;A.push(r);var z=new j();z.objInfo=D;z.dirToBody=E;z.pointInfo=A;var C=new b();C.set_restitution(Math.sqrt(p.get_material().get_restitution()*v.get_material().get_restitution()));C.set_friction(Math.sqrt(p.get_material().get_friction()*v.get_material().get_friction()));z.mat=C;B.push(z);D.body0.collisions.push(z);D.body1.collisions.push(z);}};c.CollDetectSphereCapsule=l;})(jigLib);